# ğŸ“š Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙØ§Ø² 1: Ù¾Ø§ÛŒÙ‡Ú¯Ø°Ø§Ø±ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ CRM

## âœ… ÙˆØ¶Ø¹ÛŒØª: ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡

ØªØ§Ø±ÛŒØ® ØªÚ©Ù…ÛŒÙ„: 2025-01-15

---

## ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ ÙØ§Ø² 1

Ø¯Ø± Ø§ÛŒÙ† ÙØ§Ø²ØŒ ØªÙ…Ø§Ù… Ø²ÛŒØ±Ø³Ø§Ø®Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ùˆ TypeScript types Ø¨Ø±Ø§ÛŒ Ø³ÛŒØ³ØªÙ… CRM Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯. Ø§ÛŒÙ† Ø´Ø§Ù…Ù„:

- âœ… 11 Ø¬Ø¯ÙˆÙ„ Ø§ØµÙ„ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
- âœ… Row Level Security (RLS) policies
- âœ… Indexes Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ÛŒÙ†Ù‡Ø³Ø§Ø²ÛŒ
- âœ… Functions Ùˆ Triggers Ø®ÙˆØ¯Ú©Ø§Ø±
- âœ… TypeScript types Ú©Ø§Ù…Ù„
- âœ… Helper functions Ø¨Ø±Ø§ÛŒ CRUD operations
- âœ… Constants Ùˆ Utility functions

---

## ğŸ—„ï¸ Ø³Ø§Ø®ØªØ§Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³

### Ø¬Ø¯Ø§ÙˆÙ„ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡:

#### 1. **customers** (Ù…Ø´ØªØ±ÛŒØ§Ù†)
Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´ØªØ±ÛŒØ§Ù†

**ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ:**
- `id` - Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§
- `user_id` - Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø¬Ø¯ÙˆÙ„ auth.users
- `full_name` - Ù†Ø§Ù… Ú©Ø§Ù…Ù„
- `email` - Ø§ÛŒÙ…ÛŒÙ„ (ÛŒÚ©ØªØ§)
- `phone` - Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†
- `company_name` - Ù†Ø§Ù… Ø´Ø±Ú©Øª
- `national_id` - Ú©Ø¯ Ù…Ù„ÛŒ/Ø´Ù†Ø§Ø³Ù‡ Ù…Ù„ÛŒ
- `status` - ÙˆØ¶Ø¹ÛŒØª (active, inactive, blocked)

#### 2. **projects** (Ù¾Ø±ÙˆÚ˜Ù‡Ù‡Ø§)
Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø±ÙˆÚ˜Ù‡Ù‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†

**ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ:**
- `id` - Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§
- `customer_id` - Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø´ØªØ±ÛŒ
- `service_id` - Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø®Ø¯Ù…Øª
- `title` - Ø¹Ù†ÙˆØ§Ù† Ù¾Ø±ÙˆÚ˜Ù‡
- `status` - ÙˆØ¶Ø¹ÛŒØª (draft, in_progress, review, completed, cancelled, on_hold)
- `priority` - Ø§ÙˆÙ„ÙˆÛŒØª (low, medium, high, urgent)
- `progress` - Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´Ø±ÙØª (0-100)
- `agreed_price` - Ù‚ÛŒÙ…Øª ØªÙˆØ§ÙÙ‚ÛŒ

#### 3. **project_files** (ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡)
Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù¾Ø±ÙˆÚ˜Ù‡Ù‡Ø§

#### 4. **invoices** (ÙØ§Ú©ØªÙˆØ±Ù‡Ø§)
Ù…Ø¯ÛŒØ±ÛŒØª ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ Ø¨Ø§ Ø´Ù…Ø§Ø±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø±

#### 5. **invoice_items** (Ø¢ÛŒØªÙ…Ù‡Ø§ÛŒ ÙØ§Ú©ØªÙˆØ±)
Ø¢ÛŒØªÙ…Ù‡Ø§ÛŒ Ù‡Ø± ÙØ§Ú©ØªÙˆØ±

#### 6. **payments** (Ù¾Ø±Ø¯Ø§Ø®ØªÙ‡Ø§)
Ø«Ø¨Øª Ù¾Ø±Ø¯Ø§Ø®ØªÙ‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡

#### 7. **support_tickets** (ØªÛŒÚ©ØªÙ‡Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ)
Ø³ÛŒØ³ØªÙ… ØªÛŒÚ©ØªÛŒÙ†Ú¯

#### 8. **ticket_messages** (Ù¾ÛŒØ§Ù…Ù‡Ø§ÛŒ ØªÛŒÚ©Øª)
Ù¾ÛŒØ§Ù…Ù‡Ø§ÛŒ Ø¯Ø§Ø®Ù„ ØªÛŒÚ©ØªÙ‡Ø§

#### 9. **ticket_files** (ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ ØªÛŒÚ©Øª)
ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ Ø¶Ù…ÛŒÙ…Ù‡ ØªÛŒÚ©ØªÙ‡Ø§

#### 10. **notifications** (Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù†Ù‡Ø§)
Ø³ÛŒØ³ØªÙ… Ø§Ø¹Ù„Ø§Ù†Ø§Øª

#### 11. **activity_logs** (Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªÙ‡Ø§)
Ø«Ø¨Øª ØªÙ…Ø§Ù… ÙØ¹Ø§Ù„ÛŒØªÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…

---

## ğŸ” Ø§Ù…Ù†ÛŒØª (Row Level Security)

ØªÙ…Ø§Ù… Ø¬Ø¯Ø§ÙˆÙ„ Ø¯Ø§Ø±Ø§ÛŒ RLS policies Ù‡Ø³ØªÙ†Ø¯:

- Ø§Ø¯Ù…ÛŒÙ†Ù‡Ø§ Ø¨Ù‡ ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡Ù‡Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¯Ø§Ø±Ù†Ø¯
- Ù…Ø´ØªØ±ÛŒØ§Ù† ÙÙ‚Ø· Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡Ù‡Ø§ÛŒ Ø®ÙˆØ¯Ø´Ø§Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø±Ù†Ø¯
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ `has_role(auth.uid(), 'admin')`

---

## âš¡ Functions Ùˆ Triggers

### Functions:

1. **update_updated_at_column()** - Ø¨Ù‡Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± updated_at
2. **generate_invoice_number()** - ØªÙˆÙ„ÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ ÙØ§Ú©ØªÙˆØ± (INV2501000001)
3. **generate_ticket_number()** - ØªÙˆÙ„ÛŒØ¯ Ø´Ù…Ø§Ø±Ù‡ ØªÛŒÚ©Øª (TKT000001)
4. **calculate_invoice_total()** - Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ø¬Ù…ÙˆØ¹ ÙØ§Ú©ØªÙˆØ±
5. **log_activity()** - Ø«Ø¨Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ù„Ø§Ú¯ ÙØ¹Ø§Ù„ÛŒØªÙ‡Ø§

---

## ğŸ“ ÙØ§ÛŒÙ„Ù‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡

1. `supabase/migrations/20250115000000_crm_system_base.sql` - Migration Ø§ØµÙ„ÛŒ
2. `src/integrations/supabase/types-crm.ts` - TypeScript types
3. `src/lib/crm-helpers.ts` - Helper functions
4. `src/lib/crm-constants.ts` - Constants
5. `src/lib/crm-utils.ts` - Utility functions

---

## ğŸš€ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø§Ø¬Ø±Ø§ÛŒ Migration:

Ø§Ø² Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Supabase:
1. SQL Editor > New Query
2. Ú©Ù¾ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ ÙØ§ÛŒÙ„ migration
3. Run

### Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Helper Functions:

```typescript
import { getCustomers, createCustomer } from '@/lib/crm-helpers';

const customers = await getCustomers();
```

---

## ğŸ“ˆ Ø¢Ù…Ø§Ø± ÙØ§Ø² 1

- âœ… 11 Ø¬Ø¯ÙˆÙ„ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
- âœ… 5 Function
- âœ… 10+ Trigger
- âœ… 30+ RLS Policy
- âœ… 15+ Index
- âœ… 50+ TypeScript Interface
- âœ… 40+ Helper Function
- âœ… 30+ Utility Function

---

**ÙˆØ¶Ø¹ÛŒØª:** âœ… ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡ Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡
